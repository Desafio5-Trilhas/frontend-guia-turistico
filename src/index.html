<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Turistico do Maranhão</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/style.css">

    <!--Boostrap 5-->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> -->

    <!--Font Family Roboto-->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <!--Swipper Caroousel-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/6.6.2/swiper-bundle.min.css">

</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="">Pagina inicial</a></li>
        <li><a id="openModalBtnLogin">Login</a></li>
        <li><a id="openModalBtnSignup">Cadastre-se</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <div class="main-title">
      <h1>Explore o Maranhão </h1>
      <h1>com o nosso guia</h1>
      <h2 class="h2-style-margin-t" >Nossa plataforma tem varias missões diaria que você pode aproveitar bastante. </h2>
    </div>

    <section class="section-element">
      <div class="section-card-carousel-search" id="carousel">
          <div class="search-div">
            <div style="width: 90%; display: flex;
            align-items: center;">
              <span class="title-search">Destinos populares</span>
              <input type="text" class="input-style-1" id="searchDestineValue" placeholder="Digite um ponto turistico">
              <button id="searchDestineButton" onclick="searchDestineConsult()">
                <svg xmlns="http://www.w3.org/2000/svg" height="15" width="15" viewBox="0 0 512 512">
                  <path fill="#ffffff" d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/>
                </svg>
              </button>
            </div>

            <div class="next-and-past-buttons">
              <div class="button-prev">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" height="25" width="25" viewBox="0 0 448 512">
                    <path fill="#B9BBBE" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/>
                  </svg>
                </span>
              </div>
              <div class="button-next"> 
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" height="25" width="25" viewBox="0 0 448 512">
                    <path fill="#B9BBBE" d="M438.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.8 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l306.7 0L233.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"/>
                  </svg>
                </span>
            </div>
             
            </div>

          </div>
          <div class="swiper-container">
            <div class="swiper-wrapper">               
            </div>
          </div>


      </div>
      <div class="section-card-details-info" id="tour-details" style="display: none;">
        <div class="details-div">
          <div style="width: 100%; text-align: center;">
            <span class="title-details" id="idPointInfo"></span>
          </div>

          <div class="close-details">
            <div>
              <span>
                <a onclick="closeInfoDetails(event)">
                  <svg xmlns="http://www.w3.org/2000/svg" height="25" width="25" viewBox="0 0 384 512">
                    <path  fill="#F6F1F1" d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/>
                  </svg>
                </a>
              </span>
            </div>
          </div>

        </div>

        <div class="section-tour-details-body">
          <div class="images-details">
              <span class="title-images-details" >Imagens</span>
              <div class="images-container">                
              </div>
          </div>
          <div class="location-details">
            <span class="title-location-details" >Localização</span>
            <div class="location-container">
              <span class="title-secondary" >Buscar por opções de lazer dentro deste ponto turistico</span>
              <select name="points-of-interest-name" id="id-points-of-interest">
              </select>
              <div class="image-google-maps">
              </div>
            </div>
          </div>
          <div class="mission-daily-details">
            <span class="title-mission-details" >Missões Diarias</span>
            <div class="mission-daily-container">
            </div>
          </div>
        </div>
      </div>
      <div></div>

    </section>

    <div id="modalSignup" class="modal">
        <div class="modal-content">
            <span id="closeModalSignup" class="close">&times;</span>
            <h2 class="modal-title">Cadastre-se</h2>
            <div class="modal-central-image">
              <img src="../assets/images/images-default-2.png" width="150px" height="150px">
            </div>
            <form>
              <div class="modal-form">
                <div style="width:75%">
                  <span class="input-title">CPF</span>
                  <input type="text" class="input-style-2" name="cpf" class="" >
                </div>
                <div style="width:75%">
                  <span class="input-title">Email</span>
                  <input type="Email" class="input-style-2" name="email" class="" >
                </div>
                <div style="width:75%">
                  <span class="input-title">Senha</span>
                  <input type="Password" class="input-style-2" name="password" class="" >
                </div>
                
                <button class="buttonSubmitModalLogin" >Confirmar</button>

              </div>
            </form>

        </div>
    </div>

    <div id="modalLogin" class="modal">
      <div class="modal-content">
          <span id="closeModalLogin" class="close">&times;</span>
          <h2 class="modal-title">Login</h2>
          <div class="modal-central-image">
            <img src="../assets/images/images-default-2.png" width="150px" height="150px">
          </div>
          <form>
            <div class="modal-form">
              <div style="width:75%">
                <span class="input-title">Email</span>
                <input type="Email" class="input-style-2" name="email" class="" >
              </div>
              <div style="width:75%">
                <span class="input-title">Senha</span>
                <input type="Password" class="input-style-2" name="password" class="" >
              </div>
              
              <button class="buttonSubmitModalLogin" >Entrar</button>

            </div>
          </form>
          <p class="signup-link">Não possui uma conta ainda? <a href="">Crie uma aqui!</a></p>

      </div>
  </div>
    
  </main>
  <footer>
    © copyright 2024 Todos os direitos reservados | desenvolvido por <span class="names-dev">Marcos Vinicius, Gabriel Silva e Bruno Coelho</span>
  </footer>

<!--Boostrap 5-->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script> -->
<script src="./js/create-card-items.js"></script>
<script src="./js/login-and-signup-user.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/6.6.2/swiper-bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var swiper = new Swiper('.swiper-container', {
        slidesPerView: 3, // Número de slides visíveis ao mesmo tempo
        spaceBetween: 25, // Espaçamento entre os slides
        // loop: true, // Ativar loop infinito
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        navigation: {
            nextEl: '.button-next',
            prevEl: '.button-prev',
        },
        scrollbar: {
            el: '.swiper-scrollbar',
            draggable: true,
        },
        // autoplay: {
        //     delay: 3000, // Intervalo de autoplay em milissegundos
        //     disableOnInteraction: false, // Não desativar autoplay na interação do usuário
        // },
    });
  });
    var carouselItems = document.querySelectorAll('.swiper-slide');
    var carousel = document.getElementById('carousel');
    
    carouselItems.forEach(function(item) {
        item.addEventListener('click', function() {
            carousel.style.display = 'none';
            var tourDetails = document.getElementById('tour-details');
            tourDetails.style.display = '';
            
            setTimeout(function() {
                tourDetails.classList.toggle('raised');
            }, 10); 
            // console.log(item)
            fetchInfoDetails(item)
        });
    });

    function fetchInfoDetails(item) {
      let html = "";

      const items = Object.values(jsonData);
      const itemCard = items[item.id.replace('card-item-', '')]

      document.getElementById('idPointInfo').innerHTML = itemCard.cardItemName

      let imagesContainer = document.querySelector('.images-container')

      itemCard.cardImagesSecundary.forEach((item,  index) => {
        html += `<div class="img-slide-${index}">
                <img src="${item}" width="300" height="150" alt="">
              </div>`;
      });
      imagesContainer.innerHTML = html

      let select = document.getElementById('id-points-of-interest')
      let optionHtml = "";

      itemCard.cardItemPointsOptions.forEach((item, index) => {
        optionHtml += `<option>${item}</option>`;
      });
      select.innerHTML = optionHtml

      document.querySelector('.image-google-maps').innerHTML = `
        <img src="${itemCard.cardItemImageGoogleMapsSrc}" width="auto" height="600" alt="">      
      `

      checkMissionDaily(itemCard.existMissionDaily, itemCard)

    }

    function checkMissionDaily(existMissionDaily, itemCard){
      let htmlMission = "";

      const token = localStorage.getItem('authToken');

      let missionContainer = document.querySelector('.mission-daily-container')
      
      // if(!token) {
      //   htmlMission = `
      //     <span class="title-secondary" id="mission-daily-title">
      //       Infelizmente essa opção so esta disponivel para os usuarios 
      //       cadastrados no sistema.
      //     </span>
      //     <div>
      //       <img src="../assets/images/image-default-mission01.png" width="150" height="150"alt="">
      //     </div>
      //   `
      //   missionContainer.innerHTML = htmlMission;

      //   return 
      // }

      if(existMissionDaily == true) {
        let select = document.getElementById('id-points-of-interest')
        let optionHtml = "";
        let cont = 5;
        itemCard.missionsDailyTips.forEach((item, index) => {
          htmlMission += `
            <div class="mission-tip">
              <span class="title-tip" id="mission-${index}">${item}?</span>
              <div id="tip-answer-${cont++}" style="position: relative; width: 45%">
                <input type="text" class="input-style-1">
                <span class="error-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" height="25" width="25" viewBox="0 0 512 512">
                    <path fill="#dc3545" d="M504 256c0 137-111 248-248 248S8 393 8 256C8 119.1 119 8 256 8s248 111.1 248 248zm-248 50c-25.4 0-46 20.6-46 46s20.6 46 46 46 46-20.6 46-46-20.6-46-46-46zm-43.7-165.3l7.4 136c.3 6.4 5.6 11.3 12 11.3h48.5c6.4 0 11.6-5 12-11.3l7.4-136c.4-6.9-5.1-12.7-12-12.7h-63.4c-6.9 0-12.4 5.8-12 12.7z"/>
                  </svg>
                </span>
              </div>
            </div>
          `;
        });
        htmlMission += `
          <button class="submitButtonTipStyle" onclick="submitMissionDaily(${3});">
            Salvar
          </button>

        `
        missionContainer.innerHTML = htmlMission;

        return 
      }else {
        htmlMission = `
          <span class="title-secondary" id="mission-daily-title">
            Você ja concluiu todas as missões de hoje.
          </span>
          <div>
            <img src="../assets/images/image-default-mission01.png" width="150" height="150"alt="">
          </div>
        `
        missionContainer.innerHTML = htmlMission;

        return 

      }

    }

    function submitMissionDaily(travelId) {
      let missionDailyAnswers = [];

      const url = 'https://api-guia-turistico.vercel.app/api/missao/valida-missao'
      const apiKey = 'T69ve4cPJD4rK23mEpx40LXlwhDf7Y6grwpIL03yMtX2XgiuaZp1C6HkQvgsJUu1';
      
      let missionsTips = document.querySelectorAll('.title-tip')
      let answers = document.querySelectorAll('.mission-tip input')
      let useID = 2;

      let cont = 5
      missionsTips.forEach((missionTip, index) => {
        answer = {
          "id_missao": cont++,
          "id_usuario": useID,
          "id_destino": travelId,
          "ultima_dica": missionTip.textContent,
          "resposta": answers[index].value
        }
        missionDailyAnswers.push(answer)
      })
      
      // const questions = [
      //   {
      //       "id_missao": 5,
      //       "id_usuario": 2,
      //       "id_destino": 3,
      //       "ultima_dica": "testando dica 1",
      //       "resposta": "missão de teste 1"
      //   },
      //   {
      //       "id_missao": 6,
      //       "id_usuario": 2,
      //       "id_destino": 3,
      //       "ultima_dica": "testando dica 1",
      //       "resposta": "missão de teste 2"
      //   },
      //   {
      //     "id_missao": 7,
      //     "id_usuario": 2,
      //     "id_destino": 3,
      //     "ultima_dica": "testando dica 1",
      //     "resposta": "missão de teste 3"
      //   }
      // ];

      console.log(missionDailyAnswers)

      fetch(url, {
        method: 'POST', 
        headers: {
            'Content-Type': 'application/json',
            'x-api-key': apiKey
        },
        body: JSON.stringify(missionDailyAnswers)
      }) 
      .then(response => {
          if (!response.ok) {
              throw new Error('Network response was not ok');
          }
          return response.json();
      })
      .then(data => {
          // console.log('Resposta da API:', data);
          // console.log(data.result.id)
          let missionsDailyIds = Array.from(missionsTips).map(missionTip => missionTip.id.replace('mission-', ''));
          missionsDailyIds = [5,6,7]

          // console.log(missionsDailyIds)
          try {
            for(item of missionsDailyIds) {
              document.querySelector(`#tip-answer-${item} input`).classList.remove('form-error')
              document.querySelector(`#tip-answer-${item} .error-icon`).style.display = 'none'
            }
          }catch {}
 
          if(data.result.message == 'Sucesso') {
            console.log('Sucesso')
            let missionContainer = document.querySelector('.mission-daily-container')
            
            htmlMission = `
              <span class="title-secondary" id="mission-daily-title">
                Você ja concluiu todas as missões de hoje.
              </span>
              <div>
                <img src="../assets/images/image-default-mission01.png" width="150" height="150"alt="">
              </div>
            `
            missionContainer.innerHTML = htmlMission;

          }else {
            // todos errados   
            if(data.result.id.length == 0){
              for(item of missionsDailyIds) {
                document.querySelector(`#tip-answer-${item} input`).classList.add('form-error')
                document.querySelector(`#tip-answer-${item} .error-icon`).style.display = 'flex'
              }
            }else{
              for(item of missionsDailyIds) {
                if(!data.result.id.includes(item)) {
                  document.querySelector(`#tip-answer-${item} input`).classList.add('form-error')
                  document.querySelector(`#tip-answer-${item} .error-icon`).style.display = 'flex'
                }
              }
              // console.log('nem todos estão errados')
            }
          }
      })
      .catch(error => {
          console.error('There has been a problem with your fetch operation:', error);
      });
    }

    function closeInfoDetails(el) {
      var tourDetails = document.getElementById('tour-details');
      
      tourDetails.classList.remove('raised');
      tourDetails.classList.add('closing');
      
      setTimeout(function() {
          tourDetails.style.display = 'none';
          tourDetails.classList.remove('closing');
          carousel.style.display = '';
      }, 500); 
    }

    document.getElementById('searchDestineValue').addEventListener('keypress', function(event) {
      if(event.key === 'Enter') {
        event.preventDefault();
        searchDestineConsult()
      }
    })

    function searchDestineConsult() {
      let valueText = document.getElementById('searchDestineValue').value
      console.log(valueText)
      const url = 'https://api-guia-turistico.vercel.app/api/destino/pesquisa/'+valueText;
      const apiKey = 'T69ve4cPJD4rK23mEpx40LXlwhDf7Y6grwpIL03yMtX2XgiuaZp1C6HkQvgsJUu1';
      const options = {
          method: 'GET', 
          headers: {
              'Content-Type': 'application/json',
              'x-api-key': apiKey
          }
      };

      fetch(url, options) 
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
          console.log("Return: ", data)
        })
        .catch(error => {
            console.error('There has been a problem with your fetch operation:', error);
        });

    }

</script>
</body>
</html>